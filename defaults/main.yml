---

state: "present"

foreman_version: "3.17"
foreman_version_check: "{{ foreman_version }}.0"
foreman_puppet_version: 8

default_ubuntu_mirror: "http://de.archive.ubuntu.com/ubuntu"

foreman_fw_allowed_services:
  - http
  - https

foreman_default_user: "admin"
foreman_default_password: "admin"
foreman_admin_timezone: "Europe/Berlin"
foreman_server_port: 8080
foreman_server_ssl_port: 8443
foreman_proxy_ssl_port: 1443
foreman_remote_execution_script_mode: "ssh"
foreman_remote_execution_cockpit_integration: "true"
foreman_puma_workers: 2
foreman_puma_threads_per_worker: 2
foreman_proxy_http: "true"
foreman_proxy_httpboot: "true"
foreman_proxy_http_port: 8000
foreman_server_url: "https://{{ ansible_facts.fqdn }}:{{ foreman_server_ssl_port }}"

foreman_install_flags:
  - "--foreman-initial-admin-username={{ foreman_default_user }}"
  - "--foreman-initial-admin-password={{ foreman_default_password }}"
  - "--foreman-initial-admin-timezone={{ foreman_admin_timezone }}"
  - "--foreman-server-port={{ foreman_server_port }}"
  - "--foreman-server-ssl-port={{ foreman_server_ssl_port }}"
  - "--foreman-foreman-url=\"https://{{ ansible_facts.fqdn }}:{{ foreman_server_ssl_port }}\""
  - "--foreman-unattended-url=\"http://{{ ansible_facts.fqdn }}:{{ foreman_server_port }}\""
  - "--no-enable-foreman-cli-puppet"
  - "--enable-foreman-plugin-remote-execution"
  - "--enable-foreman-cli-remote-execution"
  - "--enable-foreman-plugin-ansible"
  - "--enable-foreman-cli-ansible"
  - "--enable-foreman-plugin-bootdisk"
  - "--enable-foreman-plugin-templates"
  - "--foreman-foreman-service-puma-workers={{ foreman_puma_workers }}"
  - "--foreman-foreman-service-puma-threads-max={{ foreman_puma_threads_per_worker }}"
  - "--enable-foreman-proxy"
  - "--foreman-proxy-puppetca=false"
  - "--foreman-proxy-http={{ foreman_proxy_http }}"
  - "--foreman-proxy-http-port={{ foreman_proxy_http_port }}"
  - "--foreman-proxy-httpboot={{ foreman_proxy_httpboot }}"
  - "--foreman-proxy-ssl-port={{ foreman_proxy_ssl_port }}"
  - "--foreman-proxy-foreman-base-url=\"https://{{ ansible_facts.fqdn }}:{{ foreman_server_ssl_port }}\""
  - "--enable-foreman-proxy-plugin-ansible"
  - "--enable-foreman-proxy-plugin-remote-execution-script"
  - "--foreman-proxy-plugin-remote-execution-script-mode={{ foreman_remote_execution_script_mode }}"
  - "--foreman-proxy-plugin-remote-execution-script-cockpit-integration={{ foreman_remote_execution_cockpit_integration }}"
foreman_disable_puppet_services: true

foreman_ip: "{{ ansible_all_ipv4_addresses[0] }}"
foreman_proxy_dns: "false"
foreman_cert_validation: "false"

foreman_setup_ansible: true
foreman_ansible_default_collections_path: "{{ site_packages_path }}/ansible_collections"
foreman_ansible_root_dir: /etc/ansible
foreman_ansible_env_file: "/etc/foreman-proxy/ansible.env"
foreman_ansible_env_config:
  - "export ANSIBLE_CALLBACK_WHITELIST=\"theforeman.foreman.foreman,timer,ansible.posix.profile_tasks,ansible.posix.profile_roles\""
  - "export ANSIBLE_CALLBACKS_ENABLED=\"theforeman.foreman.foreman,timer,ansible.posix.profile_tasks,ansible.posix.profile_roles\""
foreman_default_users_src: "default_users.yml"
foreman_default_users_file_dest: "{{ foreman_ansible_root_dir }}/default_users.yml"
foreman_ansible_requirements_file_src: "requirements.yml"
foreman_ansible_requirements_file_dest: "{{ foreman_ansible_root_dir }}/requirements.yml"
foreman_ansible_roles_dir: "{{ foreman_ansible_root_dir }}/roles/"
foreman_ansible_collections_dir: "{{ foreman_ansible_root_dir }}/collections/ansible_collections"
foreman_ansible_python_version:
  redhat: "3.12"
  debian: "3.11"
# Note referenced in `/etc/foreman-proxy/settings.d/ansible.yml`
foreman_ansible_python_venv_path: "/etc/ansible/ansible_venv"
foreman_ansible_config_options:
  - key: "roles_path"
    value: "{{ foreman_ansible_roles_dir }}"
    section: "defaults"
  - key: "collections_path"
    value: "{{ foreman_ansible_collections_dir }}"
    section: "defaults"
  - key: "stdout_callback"
    value: "debug"
    section: "defaults"
  - key: "callbacks_enabled"
    value: "ansible.posix.profile_tasks"
    section: "defaults"

foreman_global_params:
  - name: "local_users_file_path"
    parameter_type: "string"
    value: "{{ foreman_ansible_root_dir }}/default_users.yml"

foreman_settings:
  - name: "ansible_post_provision_timeout"
    value: "120"
  - name: "local_boot_PXEGrub2"
    value: "PXEGrub2 custom local boot"

foreman_custom_provisioning_templates:
  - name: "PXEGrub2 custom local boot"
    kind: "PXEGrub2"
    locked: false
    control_node_source: "pxegrub2_custom_local_boot"
    file_name: "/tmp/pxegrub2_custom_local_boot"
    state: "present_with_defaults"
    locations:
      - "Default Location"
    organizations:
      - "Default Organization"

foreman_install_media:
  - name: "AlmaLinux"
    path: "https://repo.almalinux.org/almalinux/$major/BaseOS/$arch/os/"
    os_family: "Redhat"
    locations:
      - "Default Location"
    organizations:
      - "Default Organization"

foreman_domains:
  - domain_description: "subnet01"
    domain_name: "subnet01"
    domain_locations:
      - "Default Location"
    domain_organizations:
      - "Default Organization"
  - domain_description: "subnet02"
    domain_name: "subnet02"
    domain_locations:
      - "Default Location"
    domain_organizations:
      - "Default Organization"

foreman_provisioning_templates:
  - template_name: "Linux host_init_config default"
    template_kind: "host_init_config"
    locations:
      - "Default Location"
    organizations:
      - "Default Organization"
    os_list:
      - "AlmaLinux 9.7"
      - "Fedora 43"
      - "Ubuntu 24.04"
  - template_name: "Kickstart default"
    template_kind: "provision"
    locations:
      - "Default Location"
    organizations:
      - "Default Organization"
    os_list:
      - "AlmaLinux 9.7"
      - "Fedora 43"
  - template_name: "Kickstart default iPXE"
    template_kind: "iPXE"
    locations:
      - "Default Location"
    organizations:
      - "Default Organization"
    os_list:
      - "AlmaLinux 9.7"
      - "Fedora 43"
  - template_name: "Kickstart default finish"
    template_kind: "finish"
    locations:
      - "Default Location"
    organizations:
      - "Default Organization"
    os_list:
      - "AlmaLinux 9.7"
      - "Fedora 43"
  - template_name: "Kickstart default PXEGrub2"
    template_kind: "PXEGrub2"
    locations:
      - "Default Location"
    organizations:
      - "Default Organization"
    os_list:
      - "AlmaLinux 9.7"
      - "Fedora 43"
  - template_name: "Kickstart default PXELinux"
    template_kind: "PXELinux"
    locations:
      - "Default Location"
    organizations:
      - "Default Organization"
    os_list:
      - "AlmaLinux 9.7"
      - "Fedora 43"
  - template_name: "Preseed default iPXE Autoinstall"
    template_kind: "iPXE"
    locations:
      - "Default Location"
    organizations:
      - "Default Organization"
    os_list:
      - "Ubuntu 24.04"
  - template_name: "Preseed default finish"
    template_kind: "finish"
    locations:
      - "Default Location"
    organizations:
      - "Default Organization"
    os_list:
      - "Ubuntu 24.04"
  - template_name: "Preseed default PXEGrub2 Autoinstall"
    template_kind: "PXEGrub2"
    locations:
      - "Default Location"
    organizations:
      - "Default Organization"
    os_list:
      - "Ubuntu 24.04"
  - template_name: "Preseed default PXELinux Autoinstall"
    template_kind: "PXELinux"
    locations:
      - "Default Location"
    organizations:
      - "Default Organization"
    os_list:
      - "Ubuntu 24.04"
  - template_name: "Preseed Autoinstall cloud-init user data"
    template_kind: "user_data"
    locations:
      - "Default Location"
    organizations:
      - "Default Organization"
    os_list:
      - "Ubuntu 24.04"

foreman_oss:
  - name: "AlmaLinux"
    major: 9
    minor: 7
    description: "AlmaLinux 9.7"
    family: "Redhat"
    password_hash: "MD5"
    architectures:
      - "x86_64"
    ptables:
      - "Kickstart custom"
    media:
      - "AlmaLinux"
  - name: "Fedora"
    major: 43
    description: "Fedora 43"
    family: "Redhat"
    password_hash: "MD5"
    architectures:
      - "x86_64"
    ptables:
      - "Kickstart custom"
    media:
      - "Fedora mirror"
  # https://theforeman.org/2024/02/provisioning-ubuntu-autoinstall.html
  - name: "Ubuntu"
    major: "24"
    minor: "04"
    description: "Ubuntu 24.04"
    release_name: "noble"
    family: "Debian"
    password_hash: "SHA512"
    architectures:
      - "x86_64"
    ptables:
      - "Preseed default autoinstall"
    media:
      - "Ubuntu mirror"

foreman_subnets:
  - name: "SubNet01"
    descr: "SubNet01"
    network_type: "IPv4"
    network: "192.168.56.0"
    cidr: 24
    gateway: "192.168.56.1"
    dns_primary: "192.168.56.1"
    dns_secondary: ""
    ipam: "Internal DB"
    dhcp_start: "192.168.56.10"
    dhcp_end: "192.168.56.99"
    vlanid: 0
    mtu: 1500
    boot_mode: "Static"
    remote_execution_proxies:
      - "{{ ansible_facts.fqdn }}"
    domains:
      - "subnet01"
    domain_locations:
      - "Default Location"
    domain_organizations:
      - "Default Organization"
  - name: "SubNet02"
    descr: "SubNet02"
    network_type: "IPv4"
    network: "192.168.2.0"
    cidr: 24
    gateway: "192.168.2.1"
    dns_primary: "192.168.2.1"
    dns_secondary: ""
    ipam: "Internal DB"
    dhcp_start: "192.168.2.10"
    dhcp_end: "192.168.2.199"
    vlanid: 1
    mtu: 1500
    boot_mode: "Static"
    remote_execution_proxies:
      - "{{ ansible_facts.fqdn }}"
    domains:
      - "subnet02"
    domain_locations:
      - "Default Location"
    domain_organizations:
      - "Default Organization"

foreman_host_groups:
  - name: "Workstation"
    description: "Desktop systems"
    ansible_roles:
      - philnewm.local_users
      - philnewm.gnome
    subnet: "SubNet02"
    architecture: "x86_64"
    operatingsystem: "AlmaLinux 9.7"
    medium: "AlmaLinux"
    ptable: "Kickstart custom"
    pxe_loader: "Grub2 UEFI"
    locations:
      - "Default Location"
    organizations:
      - "Default Organization"
    parameters:
      - name: "state"
        parameter_type: "string"
        value: "present"
      - name: "remote_execution_ssh_user"
        parameter_type: string
        value: "config-manager"

foreman_hosts:
  - name: "test-station.subnet02"
    domain: "subnet02"
    organization: "Default Organization"
    location: "Default Location"
    hostgroup: "Workstation"
    architecture: "x86_64"
    operatingsystem: "AlmaLinux 9.7"
    build: true
    media: "AlmaLinux"
    ptable: "Kickstart custom"
    pxe_loader: "Grub2 UEFI"
    root_password: "changeme"  # Only gets set for new hosts
    interfaces_attributes:
      - type: "interface"
        mac: "12:ab:34:cd:56:ef"
        identifier: "eth1"
        name: "test-station.subnet01"
        domain: "subnet01"
        subnet: "SubNet01"
        ip: "192.168.56.105"
        managed: true
        primary: false
        provision: true
      - type: "interface"
        mac: "12:ab:34:cd:56:ef"
        identifier: "eth1.1"
        name: "test-station.subnet02"
        domain: "subnet02"
        subnet: "SubNet02"
        ip: "192.168.2.83"
        managed: true
        primary: true
        virtual: true
        execution: true
        tag: 1
        attached_to: "eth1"
    parameters:
      - name: "part_device"
        parameter_type: "string"
        value: "nvme0n1"
      - name: "part_swap_size"
        parameter_type: "integer"
        value: 32768
      - name: "part_root_percent"
        parameter_type: "integer"
        value: 40
      - name: "part_home_percent"
        parameter_type: "integer"
        value: 60
      - name: "part_fstype"
        parameter_type: "string"
        value: "xfs"
      - name: "part_vgname"
        parameter_type: "string"
        value: "almalinux"
      - name: "part_swap_name"
        parameter_type: "string"
        value: "swap"
      - name: "part_root_name"
        parameter_type: "string"
        value: "root"
      - name: "part_home_name"
        parameter_type: "string"
        value: "home"

...
